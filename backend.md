Отчет (Задание2. Бэкенд и подсистема работы с продукцией)
Цель и выбор архитектуры
Цель разработки бэкенда – создать программный модуль для работы с продукцией компании, обеспечивающий:

просмотр списка продукции;

добавление и редактирование продукции;

просмотр списка цехов для продукции;

расчет времени изготовления и необходимого сырья.

Для реализации выбран стек Python + FastAPI + SQLAlchemy. FastAPI позволяет быстро реализовать REST‑интерфейс с автоматической документацией, а SQLAlchemy упрощает работу с БД через ORM‑модели.

Структура бэкенда
Проект разделен на логические модули:

каталог database/:

models.py – определения ORM‑моделей для таблиц;

connect_db.py – создание engine, фабрики сессий, функция init_db() и зависимость get_db() для получения подключения;

crud.py – функции для операций с сущностями (создание, чтение, обновление, удаление);

services.py – бизнес‑логика расчёта времени изготовления и количества сырья.

каталог api/:

schemas.py – Pydantic‑схемы для запросов и ответов (ProductCreate, ProductUpdate, ProductOut, WorkshopOut и др.);

main.py – приложение FastAPI с объявлениями эндпоинтов.

каталог web/:

app.py – приложение Flask, отдающее HTML‑интерфейс и обрабатывающее ошибки;

templates/index.html – основная страница с интерфейсом подсистемы;

static/js/api.js, static/js/ui.js – логика взаимодействия фронтенда с бэкендом.

Такое разделение соответствует простому варианту многослойной архитектуры: слой хранения данных, слой бизнес‑логики и слой API/представления.

Реализованный функционал REST‑API
В api/main.py реализованы основные REST‑эндпоинты:

Работа с продукцией:

GET /api/products – получение списка продукций из базы данных;

GET /api/products/{id} – получение информации о конкретном продукте;

POST /api/products – добавление нового продукта с валидацией входных данных;

PUT /api/products/{id} – редактирование существующего продукта;

DELETE /api/products/{id} – удаление продукта.

Работа с цехами:

GET /api/products/{id}/workshops – получение списка цехов, участвующих в производстве выбранного продукта, с указанием типа цеха, количества работников и времени производства.

Расчет времени изготовления:

GET /api/products/{id}/time – вызов сервисной функции, которая суммирует время нахождения продукции во всех цехах (по записям DepartmentWorkTime) и возвращает целое неотрицательное значение или код ошибки при отсутствии данных.

Расчет сырья:

POST /api/raw-material – метод, принимающий тип продукции, тип материала, количество единиц и два вещественных параметра продукции. На основе коэффициента типа продукции и процента потерь сырья рассчитывается целое количество сырья. При некорректных данных метод возвращает ошибку, что соответствует требованиям задания.

Все эндпоинты используют зависимость get_db() для работы с одной сессией БД на запрос и Pydantic‑схемы для строгой типизации и валидации входных данных.

Логика расчётов (алгоритмы задания 2 и 4)
В модуле database/services.py реализованы два ключевых метода:

Метод расчета времени изготовления продукции:

получает идентификатор продукта;

выбирает все записи DepartmentWorkTime для данного продукта;

суммирует значения времени, округляет до ближайшего целого неотрицательного числа;

при отсутствии записей или некорректных данных возвращает -1.

Метод расчета количества сырья:

принимает тип продукции, тип материала, количество продукции и два вещественных параметра;

находит коэффициент типа продукции и процент потерь сырья в таблицах коэффициентов;

вычисляет необходимое сырье как произведение параметров и коэффициента, умноженное на количество и скорректированное на процент потерь;

результат округляется до целого числа, при некорректных параметрах или отсутствии справочных данных возвращается -1.

Исходный код метода расчета сырья может быть вынесен в отдельный репозиторий в соответствии с требованиями задания.

Интеграция с пользовательским интерфейсом
Пользовательский интерфейс реализован на стороне Flask/HTML/JS и взаимодействует с бэкендом по протоколу HTTP:

Flask отдает статический HTML‑шаблон и статику (CSS, JS);

JavaScript‑модуль api.js осуществляет запросы к REST‑эндпоинтам FastAPI (GET, POST, PUT, DELETE);

модуль ui.js отвечает за:

загрузку списка продукции и отображение в таблице;

открытие формы добавления/редактирования продукта и заполнение полей;

отправку формы на API с обработкой ошибок и показом уведомлений;

отображение списка цехов для выбранного продукта и времени производства.

Обработчики ошибок Flask оформлены так, чтобы информировать пользователя о некорректных запросах и внутренних сбоях, при необходимости отображая отдельные страницы для ошибок 404 и 500.
